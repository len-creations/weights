{% extends 'weightscore/Layout.html' %}

{% block body %}
    <h2>Completed Trainings</h2>

    <!-- Search Bar -->
    <form method="get" action="{% url 'view_completed_trainings' %}" class="search">
        <input type="text" name="search" placeholder="Search by Staff Number ,Name or Team " value="{{ search_query }}" class="search-input">
        <button type="submit" class="search-button">Search</button>
    </form>

    {% if employee_trainings %}
    <div class="employee-trainings-container">
        {% for employee, trainings in employee_trainings.items %}
        <div class="employee-summary">
            <h2>{{ employee.name }} ({{ employee.staff_number }}) {{ employee.Team }}</h2>
            <p><strong>Total Trainings: </strong>{{ trainings|length }}</p>
        </div>
            <table>
                <thead>
                    <tr>
                        <th>Serial No.</th> 
                        <th>Training Module</th>
                        <th>Date Completed</th>
                        <th>Date of Expiry</th>
                    </tr>
                </thead>
                <tbody>
                    {% for training in trainings %}
                        <tr>
                            <td>{{ forloop.counter }}</td> 
                            <td>
                                {% if training.training_module %}
                                    {{ training.training_module.title }}
                                {% else %}
                                    No training module found
                                {% endif %}
                            </td>
                            <td>{{ training.date_completed|date:"d-M-Y" }}</td>
                            <td>{{ training.date_of_expiry|date:"d-M-Y" }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% endfor %}
    {% else %}
</div>
        <p>No completed trainings found.</p>
    {% endif %}

    <!-- Pagination Controls -->
    <div class="pagination">
        {% if page_obj.has_previous %}
            <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}">First</a>
            <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}">Previous</a>
        {% endif %}

        <span>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}">Next</a>
            <a href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}">Last</a>
        {% endif %}
    </div>
{% endblock %}