{% extends 'weightscore/Layout.html' %}
{% load range_filter %}

{% block body %}
<a href="{% url 'employee_performance' %}" class="btn btn-primary">Home</a>

<table class="table table-striped">
    <thead>
        <tr>
            <th>Serial No.</th> 
            <th>Name</th>
            <th>Staff Number</th>
            <th>Total Weighted Score</th>
            <th>Average Score</th>
            <th>Exam</th>
            <th>Score</th>
            <th>Weighted Score</th>
            <th>Exam Date</th>
        </tr>
    </thead>
    <tbody>
        {% for performance in page_obj %}
            <tr>
                <td rowspan="{{ performance.exam_scores.count|default:1}}" class="align-middle">{{ forloop.counter }}</td>
                <td rowspan="{{ performance.exam_scores.count|default:1}}" class="align-middle">{{ performance.employee.name }}</td>
                <td rowspan="{{ performance.exam_scores.count|default:1 }}" class="align-middle">{{ performance.employee.staff_number }}</td>
                <td rowspan="{{performance.exam_scores.count|default:1}}" class="align-middle text-center">{{ performance.total_weighted_score|floatformat:2 }}</td>
                <td rowspan="{{ performance.exam_scores.count|default:1 }}" class="align-middle text-center">
                    {% if performance.average_score %}
                        {{ performance.average_score|floatformat:2 }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                {% for exam_score in performance.exam_scores %}
                    <td>{{ exam_score.exam.exam_name }}</td>
                    <td>{{ exam_score.score|floatformat:2 }}%</td> 
                    <td>{{ exam_score.weighted_score|floatformat:2 }}</td> 
                    <td>{{ exam_score.exam_date }}</td>
                </tr>
                {% endfor %}
        {% empty %}
            <tr>
                <td colspan="7">No performance data found.</td>
            </tr>
        {% endfor %}
    </tbody>
</table>
{% if page_obj.has_next %}
    <div><button>
    <a href="?page={{ page_obj.next_page_number }}">next</a>
    {% endif %}
    {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}">previous</a>
    {% endif %}
</div>

{% endblock %}